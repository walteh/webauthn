package devicecheck

import (
	"context"
	"nugg-webauthn/core/pkg/dynamo"
	"nugg-webauthn/core/pkg/hex"
	"nugg-webauthn/core/pkg/webauthn/types"
	"reflect"
	"testing"

	dtypes "github.com/aws/aws-sdk-go-v2/service/dynamodb/types"
)

type AttestTestObject struct {
	name    string
	input   DeviceCheckAttestationInput
	want    DeviceCheckAttestationOutput
	puts    []dtypes.Put
	checks  []dtypes.Update
	wantErr bool
}

var attestTestA = AttestTestObject{
	name: "A",
	input: DeviceCheckAttestationInput{
		UTF8ClientDataJSON:   "{\"challenge\":\"HaUwnocK8Yal0iz17SbtSgtvxcZLO46isdqTTAdDGd0\",\"origin\":\"https://nugg.xyz\",\"type\":\"webauthn.create\"}",
		RawAttestationObject: hex.HexToHash("0xa363666d746f6170706c652d6170706174746573746761747453746d74a263783563825902df308202db30820262a00302010202060184b047841d300a06082a8648ce3d040302304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3232313132343139333330375a170d3233313131333133323330375a3081913149304706035504030c4037316430393162343138633163373666326535393639613436613963393661353636356239303137306266383231386532653136356535303565313130343839311a3018060355040b0c114141412043657274696669636174696f6e31133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613059301306072a8648ce3d020106082a8648ce3d030107034200044a9e9ad76c6050b256c1746b133fc51f485a8f7696842b5b1ff1e10b16af8cc30f1bcfdf59ee86c31d8a7c81d494d1537c308eab3f02ac29e19d6906cd8b8cf3a381e63081e3300c0603551d130101ff04023000300e0603551d0f0101ff0404030204f0307106092a864886f76364080504643062a40302010abf893003020101bf893103020100bf893203020101bf893303020101bf893419041734343937514a534144332e78797a2e6e7567672e617070a5060404736b7320bf893603020105bf893703020100bf893903020100bf893a03020100301b06092a864886f763640807040e300cbf8a7808040631362e312e31303306092a864886f76364080204263024a1220420ba147271a67baa64d5f6d989e3193389d4119bf1d2075bbe2821bf7bf534ebe9300a06082a8648ce3d040302036700306402306d5a2877b2a73449eab63888c3825e8df5d1aacfb7d1050ddc4234ebd9a18be481eb43e4c0060347a7cbd0621b52fc5902304be779b8c2b7ca4d524488b44caed002837bcc96cefd8107049479c5842175c64bb67258485af8f4b0d73cb1752d426659024730820243308201c8a003020102021009bac5e1bc401ad9d45395bc381a0854300a06082a8648ce3d04030330523126302406035504030c1d4170706c6520417070204174746573746174696f6e20526f6f7420434131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3230303331383138333935355a170d3330303331333030303030305a304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613076301006072a8648ce3d020106052b8104002203620004ae5b37a0774d79b2358f40e7d1f22626f1c25fef17802deab3826a59874ff8d2ad1525789aa26604191248b63cb967069e98d363bd5e370fbfa08e329e8073a985e7746ea359a2f66f29db32af455e211658d567af9e267eb2614dc21a66ce99a366306430120603551d130101ff040830060101ff020100301f0603551d23041830168014ac91105333bdbe6841ffa70ca9e5faeae5e58aa1301d0603551d0e041604143ee35d1c0419a9c9b431f88474d6e1e15772e39b300e0603551d0f0101ff040403020106300a06082a8648ce3d0403030369003066023100bbbe888d738d0502cfbcfd666d09575035bcd6872c3f8430492629edd1f914e879991c9ae8b5aef8d3a85433f7b60d06023100ab38edd0cc81ed00a452c3ba44f993636553fecc297f2eb4df9f5ebe5a4acab6995c4b820df904386f7807bb589439b76772656365697074590e45308006092a864886f70d010702a0803080020101310f300d06096086480165030402010500308006092a864886f70d010701a0802480048203e8318203ff301f020102020101041734343937514a534144332e78797a2e6e7567672e617070308202e9020103020101048202df308202db30820262a00302010202060184b047841d300a06082a8648ce3d040302304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3232313132343139333330375a170d3233313131333133323330375a3081913149304706035504030c4037316430393162343138633163373666326535393639613436613963393661353636356239303137306266383231386532653136356535303565313130343839311a3018060355040b0c114141412043657274696669636174696f6e31133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613059301306072a8648ce3d020106082a8648ce3d030107034200044a9e9ad76c6050b256c1746b133fc51f485a8f7696842b5b1ff1e10b16af8cc30f1bcfdf59ee86c31d8a7c81d494d1537c308eab3f02ac29e19d6906cd8b8cf3a381e63081e3300c0603551d130101ff04023000300e0603551d0f0101ff0404030204f0307106092a864886f76364080504643062a40302010abf893003020101bf893103020100bf893203020101bf893303020101bf893419041734343937514a534144332e78797a2e6e7567672e617070a5060404736b7320bf893603020105bf893703020100bf893903020100bf893a03020100301b06092a864886f763640807040e300cbf8a7808040631362e312e31303306092a864886f76364080204263024a1220420ba147271a67baa64d5f6d989e3193389d4119bf1d2075bbe2821bf7bf534ebe9300a06082a8648ce3d040302036700306402306d5a2877b2a73449eab63888c3825e8df5d1aacfb7d1050ddc4234ebd9a18be481eb43e4c0060347a7cbd0621b52fc5902304be779b8c2b7ca4d524488b44caed002837bcc96cefd8107049479c5842175c64bb67258485af8f4b0d73cb1752d426630280201040201010420d9de5906ceec0bf891cee9cd9390bc796ccbe80900575d8cdfd6f875d5c68304306002010502010104586a75443656536b6e7779356b345834526576505776663530667a616e70456577626d39496a556e59776e425a5a6566466b6e64706f71454944556c726a5056567575547a46437752334c437242745a44565a306461773d3d300e0201060201010406415454455354300f020107020101040773616e64626f78302002010c0201010418323032322d31312d32355431393a33333a30372e3737365a30200201150201041b010418323032332d30322d32335431393a33333a30372e3737365a000000000000a080308203ae30820354a00302010202100939b4bce90cc3a1816536372f667141300a06082a8648ce3d040302307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3232303431393133333330335a170d3233303531393133333330325a305a3136303406035504030c2d4170706c69636174696f6e204174746573746174696f6e2046726175642052656365697074205369676e696e6731133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000439d4f9aa9b1cc445d65ba617acf2c084ec6f0708d59014a0e76ecf3dee3999a94c6bfb0155105555646cda8e23e026011402d07e13b9541fd8b4d657d82e9378a38201d8308201d4300c0603551d130101ff04023000301f0603551d23041830168014d917fe4b6790384b92f4dbced55780140b8f3dc9304306082b0601050507010104373035303306082b060105050730018627687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d616169636135673130313082011c0603551d20048201133082010f3082010b06092a864886f7636405013081fd3081c306082b060105050702023081b60c81b352656c69616e6365206f6e207468697320636572746966696361746520627920616e7920706172747920617373756d657320616363657074616e6365206f6620746865207468656e206170706c696361626c65207374616e64617264207465726d7320616e6420636f6e646974696f6e73206f66207573652c20636572746966696361746520706f6c69637920616e642063657274696669636174696f6e2070726163746963652073746174656d656e74732e303506082b060105050702011629687474703a2f2f7777772e6170706c652e636f6d2f6365727469666963617465617574686f72697479301d0603551d0e04160414fb67d30dbf73b792a6265d488d2cc11d95e273f8300e0603551d0f0101ff040403020780300f06092a864886f763640c0f04020500300a06082a8648ce3d04030203480030450221009490a0673773e72f7829367623b8dd51d7c89a09eabb00e39c6e450b05580bd0022047341a2bd13cc054a80a3aaacc3cc1457c00545318ea338d7d6dd5f60b2b872e308202f93082027fa003020102021056fb83d42bff8dc3379923b55aae6ebd300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3139303332323137353333335a170d3334303332323030303030305a307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000492ce63bd7d86b1ab280a3b1ce1affb04948091acf631dfa6cb28356f444be121e557dd128d8dba827c95be49fabe33caaecd0419f12f4325faf4beb3cb837ebaa381f73081f4300f0603551d130101ff040530030101ff301f0603551d23041830168014bbb0dea15833889aa48a99debebdebafdacb24ab304606082b06010505070101043a3038303606082b06010505073001862a687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d6170706c65726f6f746361673330370603551d1f0430302e302ca02aa0288626687474703a2f2f63726c2e6170706c652e636f6d2f6170706c65726f6f74636167332e63726c301d0603551d0e04160414d917fe4b6790384b92f4dbced55780140b8f3dc9300e0603551d0f0101ff0404030201063010060a2a864886f7636406020304020500300a06082a8648ce3d04030303680030650231008d6fa69fa1e0e4ec5b4e738a927f3d7853988ff4da1f581ec3754afe38a84c2a831a1aaa0da6646de1b993e8d1554ced0230673b2cb4e1e8370777cbd5ec76a81a3a553b3f356ac8c5e692b0e161be804969e45f2ba96ce11102aacc61d938b7734a30820243308201c9a00302010202082dc5fc88d2c54b95300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3134303433303138313930365a170d3339303433303138313930365a3067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533076301006072a8648ce3d020106052b810400220362000498e92f3d4072a4ed93227281131cdd1095f1c5a34e71dc1416d90ee5a6052a77647b5f4e38d3bb1c44b57ff51fb632625dc9e9845b4f304f115a00fd58580ca5f50f2c4d07471375da9797976f315ced2b9d7b203bd8b954d95e99a43a510a31a3423040301d0603551d0e04160414bbb0dea15833889aa48a99debebdebafdacb24ab300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020106300a06082a8648ce3d040303036800306502310083e9c1c4165e1a5d3418d9edeff46c0e00464bb8dfb24611c50ffde67a8ca1a66bcec203d49cf593c674b86adfaa231502306d668a10cad40dd44fcd8d433eb48a63a5336ee36dda17b7641fc85326f9886274390b175bcb51a80ce81803e7a2b22800003181fd3081fa020101308190307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b300906035504061302555302100939b4bce90cc3a1816536372f667141300d06096086480165030402010500300a06082a8648ce3d04030204473045022100a967dc17accd16742fec491709d607c3b4c62424ad70d491a3ff4ab07a2846de02207bfedc920a9a091c4712bc703bc8188a499053a52c53eb3c475c2dfeb9f9e7ae00000000000068617574684461746158a4c41fc555acfac4530a4fa4a565c197c12dd5d44d252d33299c7369b34cf577c64000000000617070617474657374646576656c6f70002071d091b418c1c76f2e5969a46a9c96a5665b90170bf8218e2e165e505e110489a50102032620012158204a9e9ad76c6050b256c1746b133fc51f485a8f7696842b5b1ff1e10b16af8cc32258200f1bcfdf59ee86c31d8a7c81d494d1537c308eab3f02ac29e19d6906cd8b8cf3"),
		RawCredentialID:      hex.HexToHash("0x71d091b418c1c76f2e5969a46a9c96a5665b90170bf8218e2e165e505e110489"),
		RawSessionID:         hex.HexToHash("0x3a298ca21194c5ee7920d2ffc5247d6fa0f330a038cf3933e138602660430b8d"),
	},
	want: DeviceCheckAttestationOutput{
		SuggestedStatusCode: 204,
		OK:                  true,
	},
	puts: []dtypes.Put{
		{
			Item: map[string]dtypes.AttributeValue{
				"challenge_id":  types.S(hex.MustBase64ToHash("HaUwnocK8Yal0iz17SbtSgtvxcZLO46isdqTTAdDGd0").Hex()),
				"session_id":    types.S("0x3a298ca21194c5ee7920d2ffc5247d6fa0f330a038cf3933e138602660430b8d"),
				"credential_id": types.S("0x"),
				"ceremony_type": types.S("webauthn.create"),
				"created_at":    types.N("1668984054"),
				"ttl":           types.N("1668984354"),
			},
			TableName: dynamo.MockCeremonyTableName(),
		},
	},
	checks: []dtypes.Update{

		{
			Key: map[string]dtypes.AttributeValue{
				"challenge_id": types.S(hex.MustBase64ToHash("HaUwnocK8Yal0iz17SbtSgtvxcZLO46isdqTTAdDGd0").Hex()),
			},
			TableName: dynamo.MockCeremonyTableName(),
			ExpressionAttributeValues: map[string]dtypes.AttributeValue{
				"challenge_id": nil,
			},
		},
		{
			Key: map[string]dtypes.AttributeValue{
				"credential_id": types.S("0x71d091b418c1c76f2e5969a46a9c96a5665b90170bf8218e2e165e505e110489"),
			},
			TableName: dynamo.MockCredentialTableName(),
			ExpressionAttributeValues: map[string]dtypes.AttributeValue{
				"session_id":       types.S("0x"),
				"aaguid":           types.S("0x617070617474657374646576656c6f70"),
				"clone_warning":    types.BOOL(false),
				"public_key":       types.S("0x044a9e9ad76c6050b256c1746b133fc51f485a8f7696842b5b1ff1e10b16af8cc30f1bcfdf59ee86c31d8a7c81d494d1537c308eab3f02ac29e19d6906cd8b8cf3"),
				"attestation_type": types.S("apple-appattest"),
				"receipt":          types.S("0x308006092a864886f70d010702a0803080020101310f300d06096086480165030402010500308006092a864886f70d010701a0802480048203e8318203ff301f020102020101041734343937514a534144332e78797a2e6e7567672e617070308202e9020103020101048202df308202db30820262a00302010202060184b047841d300a06082a8648ce3d040302304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3232313132343139333330375a170d3233313131333133323330375a3081913149304706035504030c4037316430393162343138633163373666326535393639613436613963393661353636356239303137306266383231386532653136356535303565313130343839311a3018060355040b0c114141412043657274696669636174696f6e31133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613059301306072a8648ce3d020106082a8648ce3d030107034200044a9e9ad76c6050b256c1746b133fc51f485a8f7696842b5b1ff1e10b16af8cc30f1bcfdf59ee86c31d8a7c81d494d1537c308eab3f02ac29e19d6906cd8b8cf3a381e63081e3300c0603551d130101ff04023000300e0603551d0f0101ff0404030204f0307106092a864886f76364080504643062a40302010abf893003020101bf893103020100bf893203020101bf893303020101bf893419041734343937514a534144332e78797a2e6e7567672e617070a5060404736b7320bf893603020105bf893703020100bf893903020100bf893a03020100301b06092a864886f763640807040e300cbf8a7808040631362e312e31303306092a864886f76364080204263024a1220420ba147271a67baa64d5f6d989e3193389d4119bf1d2075bbe2821bf7bf534ebe9300a06082a8648ce3d040302036700306402306d5a2877b2a73449eab63888c3825e8df5d1aacfb7d1050ddc4234ebd9a18be481eb43e4c0060347a7cbd0621b52fc5902304be779b8c2b7ca4d524488b44caed002837bcc96cefd8107049479c5842175c64bb67258485af8f4b0d73cb1752d426630280201040201010420d9de5906ceec0bf891cee9cd9390bc796ccbe80900575d8cdfd6f875d5c68304306002010502010104586a75443656536b6e7779356b345834526576505776663530667a616e70456577626d39496a556e59776e425a5a6566466b6e64706f71454944556c726a5056567575547a46437752334c437242745a44565a306461773d3d300e0201060201010406415454455354300f020107020101040773616e64626f78302002010c0201010418323032322d31312d32355431393a33333a30372e3737365a30200201150201041b010418323032332d30322d32335431393a33333a30372e3737365a000000000000a080308203ae30820354a00302010202100939b4bce90cc3a1816536372f667141300a06082a8648ce3d040302307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3232303431393133333330335a170d3233303531393133333330325a305a3136303406035504030c2d4170706c69636174696f6e204174746573746174696f6e2046726175642052656365697074205369676e696e6731133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000439d4f9aa9b1cc445d65ba617acf2c084ec6f0708d59014a0e76ecf3dee3999a94c6bfb0155105555646cda8e23e026011402d07e13b9541fd8b4d657d82e9378a38201d8308201d4300c0603551d130101ff04023000301f0603551d23041830168014d917fe4b6790384b92f4dbced55780140b8f3dc9304306082b0601050507010104373035303306082b060105050730018627687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d616169636135673130313082011c0603551d20048201133082010f3082010b06092a864886f7636405013081fd3081c306082b060105050702023081b60c81b352656c69616e6365206f6e207468697320636572746966696361746520627920616e7920706172747920617373756d657320616363657074616e6365206f6620746865207468656e206170706c696361626c65207374616e64617264207465726d7320616e6420636f6e646974696f6e73206f66207573652c20636572746966696361746520706f6c69637920616e642063657274696669636174696f6e2070726163746963652073746174656d656e74732e303506082b060105050702011629687474703a2f2f7777772e6170706c652e636f6d2f6365727469666963617465617574686f72697479301d0603551d0e04160414fb67d30dbf73b792a6265d488d2cc11d95e273f8300e0603551d0f0101ff040403020780300f06092a864886f763640c0f04020500300a06082a8648ce3d04030203480030450221009490a0673773e72f7829367623b8dd51d7c89a09eabb00e39c6e450b05580bd0022047341a2bd13cc054a80a3aaacc3cc1457c00545318ea338d7d6dd5f60b2b872e308202f93082027fa003020102021056fb83d42bff8dc3379923b55aae6ebd300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3139303332323137353333335a170d3334303332323030303030305a307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000492ce63bd7d86b1ab280a3b1ce1affb04948091acf631dfa6cb28356f444be121e557dd128d8dba827c95be49fabe33caaecd0419f12f4325faf4beb3cb837ebaa381f73081f4300f0603551d130101ff040530030101ff301f0603551d23041830168014bbb0dea15833889aa48a99debebdebafdacb24ab304606082b06010505070101043a3038303606082b06010505073001862a687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d6170706c65726f6f746361673330370603551d1f0430302e302ca02aa0288626687474703a2f2f63726c2e6170706c652e636f6d2f6170706c65726f6f74636167332e63726c301d0603551d0e04160414d917fe4b6790384b92f4dbced55780140b8f3dc9300e0603551d0f0101ff0404030201063010060a2a864886f7636406020304020500300a06082a8648ce3d04030303680030650231008d6fa69fa1e0e4ec5b4e738a927f3d7853988ff4da1f581ec3754afe38a84c2a831a1aaa0da6646de1b993e8d1554ced0230673b2cb4e1e8370777cbd5ec76a81a3a553b3f356ac8c5e692b0e161be804969e45f2ba96ce11102aacc61d938b7734a30820243308201c9a00302010202082dc5fc88d2c54b95300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3134303433303138313930365a170d3339303433303138313930365a3067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533076301006072a8648ce3d020106052b810400220362000498e92f3d4072a4ed93227281131cdd1095f1c5a34e71dc1416d90ee5a6052a77647b5f4e38d3bb1c44b57ff51fb632625dc9e9845b4f304f115a00fd58580ca5f50f2c4d07471375da9797976f315ced2b9d7b203bd8b954d95e99a43a510a31a3423040301d0603551d0e04160414bbb0dea15833889aa48a99debebdebafdacb24ab300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020106300a06082a8648ce3d040303036800306502310083e9c1c4165e1a5d3418d9edeff46c0e00464bb8dfb24611c50ffde67a8ca1a66bcec203d49cf593c674b86adfaa231502306d668a10cad40dd44fcd8d433eb48a63a5336ee36dda17b7641fc85326f9886274390b175bcb51a80ce81803e7a2b22800003181fd3081fa020101308190307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b300906035504061302555302100939b4bce90cc3a1816536372f667141300d06096086480165030402010500300a06082a8648ce3d04030204473045022100a967dc17accd16742fec491709d607c3b4c62424ad70d491a3ff4ab07a2846de02207bfedc920a9a091c4712bc703bc8188a499053a52c53eb3c475c2dfeb9f9e7ae000000000000"),
				"sign_count":       types.N("0"),
				"credential_id":    types.S("0x71d091b418c1c76f2e5969a46a9c96a5665b90170bf8218e2e165e505e110489"),
				"credential_type":  types.S("public-key"),
				// "updated_at":       types.N("1669414368"),
				// "created_at":       types.N("1669414368"),
			},
		},
	},
	wantErr: false,
}

var attestTestB = AttestTestObject{
	name: "B",
	input: DeviceCheckAttestationInput{
		UTF8ClientDataJSON:   "{\"challenge\":\"CcB74F8PT10Lordu5qtl4vFuQfOpRGhQZmCO9Z3cj48\",\"origin\":\"https://nugg.xyz\",\"type\":\"webauthn.create\"}",
		RawAttestationObject: hex.HexToHash("0xa363666d746f6170706c652d6170706174746573746761747453746d74a263783563825902e0308202dc30820262a00302010202060184b0d656b9300a06082a8648ce3d040302304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3232313132343232303930375a170d3233303831373034343030375a3081913149304706035504030c4066623166643061633938646361323839313736316261663937613438366337353732363930306433613934313035616661353938353735663839633437323935311a3018060355040b0c114141412043657274696669636174696f6e31133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613059301306072a8648ce3d020106082a8648ce3d03010703420004bee9490389b5b36c0d4bd0676c52c46426bee73ace82f6d3c4479d6b6bec24f20ad2264f7739994e636f65f280c384aa2b70c2311741027e677db62ec80071eea381e63081e3300c0603551d130101ff04023000300e0603551d0f0101ff0404030204f0307106092a864886f76364080504643062a40302010abf893003020101bf893103020100bf893203020101bf893303020101bf893419041734343937514a534144332e78797a2e6e7567672e617070a5060404736b7320bf893603020105bf893703020100bf893903020100bf893a03020100301b06092a864886f763640807040e300cbf8a7808040631362e312e31303306092a864886f76364080204263024a12204208749423ff7d8e2fbea183a2a4c2936138300528398c346332c57d80d4ddf038b300a06082a8648ce3d040302036800306502301da8920cc88f57b30c2127dbe10d7533f70fee099a7ef2a78f0ae76d7d3b12886c2edce51990511361b4194768c88ccf023100f7e2cc5cdd8f903fca505149e6ba073a2679bc8620f9645736f1181a3daf17c68e201855664d3f58977c554c26308cb559024730820243308201c8a003020102021009bac5e1bc401ad9d45395bc381a0854300a06082a8648ce3d04030330523126302406035504030c1d4170706c6520417070204174746573746174696f6e20526f6f7420434131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3230303331383138333935355a170d3330303331333030303030305a304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613076301006072a8648ce3d020106052b8104002203620004ae5b37a0774d79b2358f40e7d1f22626f1c25fef17802deab3826a59874ff8d2ad1525789aa26604191248b63cb967069e98d363bd5e370fbfa08e329e8073a985e7746ea359a2f66f29db32af455e211658d567af9e267eb2614dc21a66ce99a366306430120603551d130101ff040830060101ff020100301f0603551d23041830168014ac91105333bdbe6841ffa70ca9e5faeae5e58aa1301d0603551d0e041604143ee35d1c0419a9c9b431f88474d6e1e15772e39b300e0603551d0f0101ff040403020106300a06082a8648ce3d0403030369003066023100bbbe888d738d0502cfbcfd666d09575035bcd6872c3f8430492629edd1f914e879991c9ae8b5aef8d3a85433f7b60d06023100ab38edd0cc81ed00a452c3ba44f993636553fecc297f2eb4df9f5ebe5a4acab6995c4b820df904386f7807bb589439b76772656365697074590e46308006092a864886f70d010702a0803080020101310f300d06096086480165030402010500308006092a864886f70d010701a0802480048203e831820400301f020102020101041734343937514a534144332e78797a2e6e7567672e617070308202ea020103020101048202e0308202dc30820262a00302010202060184b0d656b9300a06082a8648ce3d040302304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3232313132343232303930375a170d3233303831373034343030375a3081913149304706035504030c4066623166643061633938646361323839313736316261663937613438366337353732363930306433613934313035616661353938353735663839633437323935311a3018060355040b0c114141412043657274696669636174696f6e31133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613059301306072a8648ce3d020106082a8648ce3d03010703420004bee9490389b5b36c0d4bd0676c52c46426bee73ace82f6d3c4479d6b6bec24f20ad2264f7739994e636f65f280c384aa2b70c2311741027e677db62ec80071eea381e63081e3300c0603551d130101ff04023000300e0603551d0f0101ff0404030204f0307106092a864886f76364080504643062a40302010abf893003020101bf893103020100bf893203020101bf893303020101bf893419041734343937514a534144332e78797a2e6e7567672e617070a5060404736b7320bf893603020105bf893703020100bf893903020100bf893a03020100301b06092a864886f763640807040e300cbf8a7808040631362e312e31303306092a864886f76364080204263024a12204208749423ff7d8e2fbea183a2a4c2936138300528398c346332c57d80d4ddf038b300a06082a8648ce3d040302036800306502301da8920cc88f57b30c2127dbe10d7533f70fee099a7ef2a78f0ae76d7d3b12886c2edce51990511361b4194768c88ccf023100f7e2cc5cdd8f903fca505149e6ba073a2679bc8620f9645736f1181a3daf17c68e201855664d3f58977c554c26308cb53028020104020101042049e739fa222e42b6d5cb2b24522477deeead2ce1097f931c3400586cb38afe9030600201050201010458734a4b726d4f414e3974307850343858636a5a38696c78783052326932566f3555314a38516d31594d546f456d4579423079487a54385854473252776153775262675a694e435a78344230477a5063464736553165413d3d300e0201060201010406415454455354300f020107020101040773616e64626f78302002010c0201010418323032322d31312d32355432323a30393a30372e3830345a302002011502041c01010418323032332d30322d32335432323a30393a30372e3830345a000000000000a080308203ae30820354a00302010202100939b4bce90cc3a1816536372f667141300a06082a8648ce3d040302307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3232303431393133333330335a170d3233303531393133333330325a305a3136303406035504030c2d4170706c69636174696f6e204174746573746174696f6e2046726175642052656365697074205369676e696e6731133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000439d4f9aa9b1cc445d65ba617acf2c084ec6f0708d59014a0e76ecf3dee3999a94c6bfb0155105555646cda8e23e026011402d07e13b9541fd8b4d657d82e9378a38201d8308201d4300c0603551d130101ff04023000301f0603551d23041830168014d917fe4b6790384b92f4dbced55780140b8f3dc9304306082b0601050507010104373035303306082b060105050730018627687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d616169636135673130313082011c0603551d20048201133082010f3082010b06092a864886f7636405013081fd3081c306082b060105050702023081b60c81b352656c69616e6365206f6e207468697320636572746966696361746520627920616e7920706172747920617373756d657320616363657074616e6365206f6620746865207468656e206170706c696361626c65207374616e64617264207465726d7320616e6420636f6e646974696f6e73206f66207573652c20636572746966696361746520706f6c69637920616e642063657274696669636174696f6e2070726163746963652073746174656d656e74732e303506082b060105050702011629687474703a2f2f7777772e6170706c652e636f6d2f6365727469666963617465617574686f72697479301d0603551d0e04160414fb67d30dbf73b792a6265d488d2cc11d95e273f8300e0603551d0f0101ff040403020780300f06092a864886f763640c0f04020500300a06082a8648ce3d04030203480030450221009490a0673773e72f7829367623b8dd51d7c89a09eabb00e39c6e450b05580bd0022047341a2bd13cc054a80a3aaacc3cc1457c00545318ea338d7d6dd5f60b2b872e308202f93082027fa003020102021056fb83d42bff8dc3379923b55aae6ebd300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3139303332323137353333335a170d3334303332323030303030305a307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000492ce63bd7d86b1ab280a3b1ce1affb04948091acf631dfa6cb28356f444be121e557dd128d8dba827c95be49fabe33caaecd0419f12f4325faf4beb3cb837ebaa381f73081f4300f0603551d130101ff040530030101ff301f0603551d23041830168014bbb0dea15833889aa48a99debebdebafdacb24ab304606082b06010505070101043a3038303606082b06010505073001862a687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d6170706c65726f6f746361673330370603551d1f0430302e302ca02aa0288626687474703a2f2f63726c2e6170706c652e636f6d2f6170706c65726f6f74636167332e63726c301d0603551d0e04160414d917fe4b6790384b92f4dbced55780140b8f3dc9300e0603551d0f0101ff0404030201063010060a2a864886f7636406020304020500300a06082a8648ce3d04030303680030650231008d6fa69fa1e0e4ec5b4e738a927f3d7853988ff4da1f581ec3754afe38a84c2a831a1aaa0da6646de1b993e8d1554ced0230673b2cb4e1e8370777cbd5ec76a81a3a553b3f356ac8c5e692b0e161be804969e45f2ba96ce11102aacc61d938b7734a30820243308201c9a00302010202082dc5fc88d2c54b95300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3134303433303138313930365a170d3339303433303138313930365a3067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533076301006072a8648ce3d020106052b810400220362000498e92f3d4072a4ed93227281131cdd1095f1c5a34e71dc1416d90ee5a6052a77647b5f4e38d3bb1c44b57ff51fb632625dc9e9845b4f304f115a00fd58580ca5f50f2c4d07471375da9797976f315ced2b9d7b203bd8b954d95e99a43a510a31a3423040301d0603551d0e04160414bbb0dea15833889aa48a99debebdebafdacb24ab300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020106300a06082a8648ce3d040303036800306502310083e9c1c4165e1a5d3418d9edeff46c0e00464bb8dfb24611c50ffde67a8ca1a66bcec203d49cf593c674b86adfaa231502306d668a10cad40dd44fcd8d433eb48a63a5336ee36dda17b7641fc85326f9886274390b175bcb51a80ce81803e7a2b22800003181fd3081fa020101308190307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b300906035504061302555302100939b4bce90cc3a1816536372f667141300d06096086480165030402010500300a06082a8648ce3d0403020447304502205a59898ffdde0d2a1b8135006b746ea2efe9f5386c920541dbd1c9912283ef38022100a3ea3ca0e32f9025fcc878dde76d56138a39b9ff52624172a68d54672cb177cb00000000000068617574684461746158a4c41fc555acfac4530a4fa4a565c197c12dd5d44d252d33299c7369b34cf577c64000000000617070617474657374646576656c6f700020fb1fd0ac98dca2891761baf97a486c75726900d3a94105afa598575f89c47295a5010203262001215820bee9490389b5b36c0d4bd0676c52c46426bee73ace82f6d3c4479d6b6bec24f22258200ad2264f7739994e636f65f280c384aa2b70c2311741027e677db62ec80071ee"),
		RawCredentialID:      hex.HexToHash("0xfb1fd0ac98dca2891761baf97a486c75726900d3a94105afa598575f89c47295"),
		RawSessionID:         hex.HexToHash("0x3a298ca21194c5ee7920d2ffc5247d6fa0f330a038cf3933e138602660430b8d"),
	},
	want: DeviceCheckAttestationOutput{
		SuggestedStatusCode: 204,
		OK:                  true,
	},
	puts: []dtypes.Put{
		{
			Item: map[string]dtypes.AttributeValue{
				"challenge_id":  types.S(hex.MustBase64ToHash("CcB74F8PT10Lordu5qtl4vFuQfOpRGhQZmCO9Z3cj48").Hex()),
				"session_id":    types.S("0x3a298ca21194c5ee7920d2ffc5247d6fa0f330a038cf3933e138602660430b8d"),
				"credential_id": types.S("0x"),
				"ceremony_type": types.S("webauthn.create"),
				"created_at":    types.N("1668984054"),
				"ttl":           types.N("1668984354"),
			},
			TableName: dynamo.MockCeremonyTableName(),
		},
	},
	checks: []dtypes.Update{

		{
			Key: map[string]dtypes.AttributeValue{
				"challenge_id": types.S(hex.MustBase64ToHash("CcB74F8PT10Lordu5qtl4vFuQfOpRGhQZmCO9Z3cj48").Hex()),
			},
			TableName: dynamo.MockCeremonyTableName(),
			ExpressionAttributeValues: map[string]dtypes.AttributeValue{
				"challenge_id": nil,
			},
		},
		{
			Key: map[string]dtypes.AttributeValue{
				"credential_id": types.S("0xfb1fd0ac98dca2891761baf97a486c75726900d3a94105afa598575f89c47295"),
			},
			TableName: dynamo.MockCredentialTableName(),
			ExpressionAttributeValues: map[string]dtypes.AttributeValue{
				"session_id":       types.S("0x"),
				"aaguid":           types.S("0x617070617474657374646576656c6f70"),
				"clone_warning":    types.BOOL(false),
				"public_key":       types.S("0x04bee9490389b5b36c0d4bd0676c52c46426bee73ace82f6d3c4479d6b6bec24f20ad2264f7739994e636f65f280c384aa2b70c2311741027e677db62ec80071ee"),
				"attestation_type": types.S("apple-appattest"),
				"receipt":          types.S("0x308006092a864886f70d010702a0803080020101310f300d06096086480165030402010500308006092a864886f70d010701a0802480048203e831820400301f020102020101041734343937514a534144332e78797a2e6e7567672e617070308202ea020103020101048202e0308202dc30820262a00302010202060184b0d656b9300a06082a8648ce3d040302304f3123302106035504030c1a4170706c6520417070204174746573746174696f6e204341203131133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e6961301e170d3232313132343232303930375a170d3233303831373034343030375a3081913149304706035504030c4066623166643061633938646361323839313736316261663937613438366337353732363930306433613934313035616661353938353735663839633437323935311a3018060355040b0c114141412043657274696669636174696f6e31133011060355040a0c0a4170706c6520496e632e3113301106035504080c0a43616c69666f726e69613059301306072a8648ce3d020106082a8648ce3d03010703420004bee9490389b5b36c0d4bd0676c52c46426bee73ace82f6d3c4479d6b6bec24f20ad2264f7739994e636f65f280c384aa2b70c2311741027e677db62ec80071eea381e63081e3300c0603551d130101ff04023000300e0603551d0f0101ff0404030204f0307106092a864886f76364080504643062a40302010abf893003020101bf893103020100bf893203020101bf893303020101bf893419041734343937514a534144332e78797a2e6e7567672e617070a5060404736b7320bf893603020105bf893703020100bf893903020100bf893a03020100301b06092a864886f763640807040e300cbf8a7808040631362e312e31303306092a864886f76364080204263024a12204208749423ff7d8e2fbea183a2a4c2936138300528398c346332c57d80d4ddf038b300a06082a8648ce3d040302036800306502301da8920cc88f57b30c2127dbe10d7533f70fee099a7ef2a78f0ae76d7d3b12886c2edce51990511361b4194768c88ccf023100f7e2cc5cdd8f903fca505149e6ba073a2679bc8620f9645736f1181a3daf17c68e201855664d3f58977c554c26308cb53028020104020101042049e739fa222e42b6d5cb2b24522477deeead2ce1097f931c3400586cb38afe9030600201050201010458734a4b726d4f414e3974307850343858636a5a38696c78783052326932566f3555314a38516d31594d546f456d4579423079487a54385854473252776153775262675a694e435a78344230477a5063464736553165413d3d300e0201060201010406415454455354300f020107020101040773616e64626f78302002010c0201010418323032322d31312d32355432323a30393a30372e3830345a302002011502041c01010418323032332d30322d32335432323a30393a30372e3830345a000000000000a080308203ae30820354a00302010202100939b4bce90cc3a1816536372f667141300a06082a8648ce3d040302307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3232303431393133333330335a170d3233303531393133333330325a305a3136303406035504030c2d4170706c69636174696f6e204174746573746174696f6e2046726175642052656365697074205369676e696e6731133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000439d4f9aa9b1cc445d65ba617acf2c084ec6f0708d59014a0e76ecf3dee3999a94c6bfb0155105555646cda8e23e026011402d07e13b9541fd8b4d657d82e9378a38201d8308201d4300c0603551d130101ff04023000301f0603551d23041830168014d917fe4b6790384b92f4dbced55780140b8f3dc9304306082b0601050507010104373035303306082b060105050730018627687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d616169636135673130313082011c0603551d20048201133082010f3082010b06092a864886f7636405013081fd3081c306082b060105050702023081b60c81b352656c69616e6365206f6e207468697320636572746966696361746520627920616e7920706172747920617373756d657320616363657074616e6365206f6620746865207468656e206170706c696361626c65207374616e64617264207465726d7320616e6420636f6e646974696f6e73206f66207573652c20636572746966696361746520706f6c69637920616e642063657274696669636174696f6e2070726163746963652073746174656d656e74732e303506082b060105050702011629687474703a2f2f7777772e6170706c652e636f6d2f6365727469666963617465617574686f72697479301d0603551d0e04160414fb67d30dbf73b792a6265d488d2cc11d95e273f8300e0603551d0f0101ff040403020780300f06092a864886f763640c0f04020500300a06082a8648ce3d04030203480030450221009490a0673773e72f7829367623b8dd51d7c89a09eabb00e39c6e450b05580bd0022047341a2bd13cc054a80a3aaacc3cc1457c00545318ea338d7d6dd5f60b2b872e308202f93082027fa003020102021056fb83d42bff8dc3379923b55aae6ebd300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3139303332323137353333335a170d3334303332323030303030305a307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533059301306072a8648ce3d020106082a8648ce3d0301070342000492ce63bd7d86b1ab280a3b1ce1affb04948091acf631dfa6cb28356f444be121e557dd128d8dba827c95be49fabe33caaecd0419f12f4325faf4beb3cb837ebaa381f73081f4300f0603551d130101ff040530030101ff301f0603551d23041830168014bbb0dea15833889aa48a99debebdebafdacb24ab304606082b06010505070101043a3038303606082b06010505073001862a687474703a2f2f6f6373702e6170706c652e636f6d2f6f63737030332d6170706c65726f6f746361673330370603551d1f0430302e302ca02aa0288626687474703a2f2f63726c2e6170706c652e636f6d2f6170706c65726f6f74636167332e63726c301d0603551d0e04160414d917fe4b6790384b92f4dbced55780140b8f3dc9300e0603551d0f0101ff0404030201063010060a2a864886f7636406020304020500300a06082a8648ce3d04030303680030650231008d6fa69fa1e0e4ec5b4e738a927f3d7853988ff4da1f581ec3754afe38a84c2a831a1aaa0da6646de1b993e8d1554ced0230673b2cb4e1e8370777cbd5ec76a81a3a553b3f356ac8c5e692b0e161be804969e45f2ba96ce11102aacc61d938b7734a30820243308201c9a00302010202082dc5fc88d2c54b95300a06082a8648ce3d0403033067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b3009060355040613025553301e170d3134303433303138313930365a170d3339303433303138313930365a3067311b301906035504030c124170706c6520526f6f74204341202d20473331263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b30090603550406130255533076301006072a8648ce3d020106052b810400220362000498e92f3d4072a4ed93227281131cdd1095f1c5a34e71dc1416d90ee5a6052a77647b5f4e38d3bb1c44b57ff51fb632625dc9e9845b4f304f115a00fd58580ca5f50f2c4d07471375da9797976f315ced2b9d7b203bd8b954d95e99a43a510a31a3423040301d0603551d0e04160414bbb0dea15833889aa48a99debebdebafdacb24ab300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020106300a06082a8648ce3d040303036800306502310083e9c1c4165e1a5d3418d9edeff46c0e00464bb8dfb24611c50ffde67a8ca1a66bcec203d49cf593c674b86adfaa231502306d668a10cad40dd44fcd8d433eb48a63a5336ee36dda17b7641fc85326f9886274390b175bcb51a80ce81803e7a2b22800003181fd3081fa020101308190307c3130302e06035504030c274170706c65204170706c69636174696f6e20496e746567726174696f6e2043412035202d20473131263024060355040b0c1d4170706c652043657274696669636174696f6e20417574686f7269747931133011060355040a0c0a4170706c6520496e632e310b300906035504061302555302100939b4bce90cc3a1816536372f667141300d06096086480165030402010500300a06082a8648ce3d0403020447304502205a59898ffdde0d2a1b8135006b746ea2efe9f5386c920541dbd1c9912283ef38022100a3ea3ca0e32f9025fcc878dde76d56138a39b9ff52624172a68d54672cb177cb000000000000"),
				"sign_count":       types.N("0"),
				"credential_id":    types.S("0xfb1fd0ac98dca2891761baf97a486c75726900d3a94105afa598575f89c47295"),
				"credential_type":  types.S("public-key"),
				// "updated_at":       types.N("1669414368"),
				// "created_at":       types.N("1669414368"),
			},
		},
	},
	wantErr: false,
}

func TestAttest(t *testing.T) {

	dynamo.AttachLocalDynamoServer(t)

	tests := []AttestTestObject{
		attestTestA, attestTestB,
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {

			client := dynamo.NewMockClient(t)

			dynamo.MockBatchPut(t, client, tt.puts...)

			got, err := Attest(context.Background(), client, tt.input)
			if err != nil && !tt.wantErr {
				t.Errorf("handler.Invoke() - error should always be nil - error = %v", err)
				return
			}

			if got.SuggestedStatusCode != 204 {
				if !tt.wantErr {
					t.Errorf("Handler.Invoke() error = %v, wantErr %v", err, tt.wantErr)
				}

				if got.SuggestedStatusCode != tt.want.SuggestedStatusCode {
					t.Errorf("Handler.Invoke() got = %v, want %v", got, tt.want)
				}
			} else if !reflect.DeepEqual(got, tt.want) {
				t.Errorf("Handler.Invoke() = %v, want %v", got, tt.want)
			}

			dynamo.MockBatchCheck(t, client, tt.checks...)

		})
	}
}
